# UPPSC Questions Supabase Workflow

This workflow processes UPPSC 2024 Prelims GS1 questions and uploads them to Supabase with comprehensive Grok AI analysis for student performance assessment.

## 🎯 Purpose

The goal is to create a smart question bank that can:
- Assess student performance accurately
- Identify knowledge gaps
- Provide personalized study recommendations
- Guide improvement strategies
- Build confidence and motivation

## 📋 Prerequisites

1. **Environment Variables** (in `../.env`):
   ```
   GROK_API_KEY=your_grok_api_key_here
   SUPABASE_URL=your_supabase_url_here
   SUPABASE_ANON_KEY=your_supabase_anon_key_here
   ```

2. **Input File**: `uppsc_questions_complete_final.json` (150 questions with answers)

3. **Database**: Supabase table `pyq_question_table` with the schema provided

## 🗄️ Database Schema

Run the SQL in `add_exam_type_column.sql` to add the `exam_type` column to your existing table.

## 📁 Files Generated

1. **`uppsc_questions_supabase_ready.json`** - Questions transformed for Supabase format
2. **`uppsc_questions_with_grok_analysis.json`** - Questions with comprehensive Grok analysis
3. **`supabase_upload_report.json`** - Upload results and statistics

## 🚀 Quick Start

### Option 1: Complete Workflow (Recommended)
```bash
python3 complete_workflow.py
```

### Option 2: Step by Step
```bash
# Step 1: Transform questions
python3 transform_for_supabase.py

# Step 2: Run Grok analysis (requires API key)
python3 grok_analysis_script.py

# Step 3: Upload to Supabase
python3 supabase_upload_script.py
```

## 🔧 Individual Scripts

### 1. `transform_for_supabase.py`
- Transforms UPPSC questions to Supabase database format
- Removes duplicate question 132
- Adds required fields with placeholder values for Grok analysis

### 2. `grok_analysis_script.py`
- Analyzes each question using Grok AI
- Focuses on performance assessment and personalized guidance
- Provides 25 different analysis fields for each question
- Includes rate limiting and error handling

### 3. `supabase_upload_script.py`
- Uploads analyzed questions to Supabase database
- Handles batch uploads and error reporting
- Checks for existing questions to avoid duplicates
- Generates upload reports

### 4. `complete_workflow.py`
- Orchestrates all steps in sequence
- Provides progress tracking and error handling
- Interactive confirmations for API usage

## 📊 Analysis Fields Generated by Grok

Each question gets comprehensive analysis including:

- **Explanation**: Step-by-step explanation of the correct answer
- **Primary/Secondary Type**: Question categorization
- **Difficulty Level**: Easy/Medium/Hard/Very Hard with reasoning
- **Knowledge Requirement**: Specific knowledge needed
- **Testing Objective**: What skill/concept is being tested
- **Question Design Strategy**: How the question is structured
- **Trap Setting**: Common mistakes and traps
- **Options Analysis**: Detailed analysis of each option
- **Key Concepts**: Main topics being tested
- **Common Mistakes**: What students typically get wrong
- **Elimination Technique**: How to eliminate wrong options
- **Memory Hooks**: Mnemonics and memory aids
- **Related Topics**: Connected topics for further study
- **Current Affairs Connection**: Current events relevance
- **Time Management**: Recommended time allocation
- **Confidence Calibration**: How to assess confidence
- **Source Material**: Recommended study sources
- **Learning Insights**: Key takeaways for improvement
- **Examiner Thought Process**: What the examiner was thinking
- **Motivation**: Why this topic is important

## 🎯 Performance Assessment Focus

The analysis is specifically designed to help:

1. **Accurate Assessment**: Understand why students get questions right/wrong
2. **Knowledge Gap Identification**: Identify specific areas of weakness
3. **Personalized Recommendations**: Suggest targeted study materials
4. **Improvement Strategies**: Guide students on how to improve
5. **Confidence Building**: Help students understand their strengths

## ⚙️ Configuration

### Batch Sizes
- **Grok Analysis**: 5 questions per batch (to avoid rate limits)
- **Supabase Upload**: 10 questions per batch (for efficiency)

### Rate Limiting
- 2 seconds between individual question analysis
- 10 seconds between batches
- 60-second timeout for API calls

## 🔍 Error Handling

- **API Failures**: Fallback analysis provided
- **Network Issues**: Retry logic with timeouts
- **Database Errors**: Detailed error reporting
- **JSON Parsing**: Robust parsing with fallbacks

## 📈 Expected Output

After running the complete workflow, you'll have:

- **150 UPPSC questions** in your Supabase database
- **Comprehensive analysis** for each question
- **Performance assessment** capabilities
- **Personalized guidance** framework
- **Detailed upload reports** for monitoring

## 🛠️ Troubleshooting

### Common Issues:

1. **Missing Environment Variables**
   - Check your `.env` file in the parent directory
   - Ensure all required API keys are set

2. **API Rate Limits**
   - The script includes built-in rate limiting
   - Increase delays if you encounter rate limit errors

3. **Database Connection Issues**
   - Verify your Supabase URL and API key
   - Check your database permissions

4. **Missing Input File**
   - Ensure `uppsc_questions_complete_final.json` exists
   - Verify it contains 150 questions

## 📞 Support

If you encounter issues:
1. Check the generated log files
2. Verify your API keys and database credentials
3. Review the error messages in the console output

## 🎉 Success Indicators

The workflow is successful when:
- All 150 questions are uploaded to Supabase
- Each question has comprehensive Grok analysis
- Upload report shows 100% success rate
- Database contains all required fields

Your UPPSC question bank is now ready for smart student performance assessment and personalized guidance! 